<% provide(:title, @post.title) %>
<% provide(:desc, @post.meta_description) %>

<div itemscope itemtype="http://schema.org/BlogPosting">

  <div class="social-arrow">
    <%= image_tag("share.png", alt: 'show share buttons', title: 'show share buttons', class: 'social-arrow-img')  %>
  </div>

  <div class="social-bar">
    <div class="social-button">
      <div id="fb-root"></div>
      <div class="fb-like" data-href="<%= post_url(@post) %>" data-send="false" data-layout="box_count" data-width="55" data-show-faces="false"></div>
    </div>
    <div class="social-button">
      <su:badge layout="5" location="<%= post_url(@post) %>"></su:badge>
    </div>
    <div class="social-button">
      <div class="g-plusone" data-size="tall" data-href="<%= post_url(@post) %>"></div>
    </div>
    <div class="social-button">
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="<%= post_url(@post) %>" data-via="stuwashere" data-count="vertical">Tweet</a>
    </div>
  </div>

  <h1 itemprop="headline"><%= @post.title %></h1>
  <meta itemprop="image" content="<%= @post.pic_large_url %>">
  <meta itemprop="thumbnailUrl" content="<%= @post.pic_thumbnail_url %>">
  <meta itemprop="author" content="Stuart Morris">

  <div class="meta-well">
    <span class="post-meta-unit">
      <i class="icon-calendar"></i>
      <time itemprop="datePublished" datetime="<%= @post.created_at %>" >
        <%= content_tag :span, pretty_date(@post.created_at), class: 'post-date' %>
      </time>
    </span>

    <span class="post-meta-unit">
      <i class="icon-tags"></i>
      <%= @post.categories.map { |c|
              "<a href=\"#{category_path(c)}\">#{c.name}</a>"
             }.join(', ').html_safe %>
    </span>

    <% if can? :edit, @post %>

      <span class="post-meta-unit">
        <i class="icon-edit"></i>
        <%= link_to 'Edit', edit_post_path(@post) %>
      </span>

      <span class="post-meta-unit">
        <i class="icon-remove"></i>
        <%= link_to 'Delete', @post, method: :delete, data: { confirm: 'Are you sure?' } %>
      </span>

    <% end %>
  </div>

  <div class="post-header-pic">
    <%= link_to image_tag(@post.pic_large_url, alt: @post.picture_alt_text, title: @post.picture_alt_text), @post.pic_large_url, class: 'fancybox' %>
  </div>

  <div class="post-citations">
    <div class="citation-link">
      <p>Picture Sources</p>
      <i class="icon-chevron-down citation-chevron"></i>
    </div>

    <div class="citation-dropdown">
      <ul>
        <% @post.citations.each do |citation| %>
          <li>
            <%= link_to citation.text, citation.url, rel: 'nofollow', target: '_blank' %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>

  <div class="post-content" itemprop="text">
    <%= simple_format @post.content %>
  </div>

  <div class="bottom-of-post">

    <div class="newsletter">
      <div class="newsletter-prompt">
        Our Newsletter: Extra Content, Exclusive Offers And More
      </div>
      <div class="newsletter-content">
        <%= form_tag newsletters_newsletter_sign_up_path, method: 'get', class: 'newsletter-form' do %>
          <div class="newsletter-inputs">
            <%= text_field_tag :name, params[:name], placeholder: 'Name' %>
            <%= text_field_tag :email_address, params[:email_address], placeholder: 'Email Address' %>
          </div>
          <%= submit_tag "Subscribe", class: 'newsletter-submit' %>
        <% end %>
      </div>
    </div>

    <h2 class="h2-margin-left">Related Posts</h2>

    <% @post.related.each_with_index do |post, i| %>
      <div class="related-div <%= i == 3 ? 'last-related-pic' : '' %>">
        <a href="<%= post_path(post) %>">
          <%= image_tag post.pic_large_square_url, alt: post.picture_alt_text, title: post.picture_alt_text, class: "related-post-pic" %>
          <%= content_tag :span, post.title, class: 'related-post-title' %>
        </a>
      </div>
    <% end %>
  </div>

</div>
